############################################################################
############################################################################
###################  ANALYSES - INDICATEURS  ###############################
############################################################################
############################################################################

## Date : 15/11/2024 
## Auteur : ....

##########################################################################
########################### Fonction utiles ##############################
##########################################################################

library(dplyr)
library(tidyverse)
install.packages("readxl")
library("readxl")
#%>% 
#|> 
#read_excel()
#select() avec start_with() par exemple
#filter()
#mutate()
#fct_recode()
#group_by_()
#summarise()
#left_join() right_join() inner_join() full_join()
#pivot_longer() pivot_wider()
# ...


##########################################################################
########################### Import #######################################
##########################################################################

Sites <- read_excel("Sites.xlsx")
Microorga <- read_excel("Microorganismes.xlsx")
Nematodes <- read_excel("Nematodes.xlsx")
Vers <- read_excel("Lombrics.xlsx")

##########################################################################
######################### Jointure de tables #############################
##########################################################################
########### CONSIGNE : Choisir deux communauté biologique ###########
result<- left_join(Microorga, Nematodes, by = "ID")
inner_join(Sites,Microorga,by = "ID")
Sites %>% 
  inner_join(.,Microorga,join_by(ID)) %>%  
  inner_join(.,Nematodes,join_by(ID)) %>% 
  inner_join(.,Vers,join_by(ID))-> tout


##########################################################################
################## Sélection de lignes et colonnes ##################
##########################################################################
########### CONSIGNE : Choisir un site ###########

filter(tout,SITE == "Feucherolles") -> tou_feu


##########################################################################
####################### Créer des variables ##################
##########################################################################
tou_feu %>% 
  mutate(total = CARNI+FONG+OMNI)->tout_add
#mutate(Pphyto=100*(PHYTO/rowSums(across(c(PHYTO:CARNI)))))
##########################################################################
############################## Calculs par groupe ########################
##########################################################################
########### CONSIGNE : calculs sur plusieurs variables en même temps######

tout_add %>% 
  group_by(MODALITE_DESCR) %>% 
  summarise(mean_Pp=mean(total), sd_Pp=sd(total))-> tout_gro

##########################################################################
####################### Graphique ########################
##########################################################################
########### CONSIGNE : un graphique en modifiant l'ordre et en recodant des modalités


##########################################################################
######################## Pivots ##########################################
##########################################################################

aa<-pivot_longer(total_Feucherolles_2,starts_with("SABLE_"), values_to = "amount")


##########################################################################
####################### Enchaîner tous les traitements ###################
##########################################################################

